<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Crew Launcher Plugins for Traditional High-Performance Computing Clusters • crew.cluster</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Crew Launcher Plugins for Traditional High-Performance Computing Clusters">
<meta name="description" content="In computationally demanding analysis projects, statisticians and data scientists asynchronously deploy long-running tasks to distributed systems, ranging from traditional clusters to cloud services. The crew.cluster package extends the mirai-powered crew package with worker launcher plugins for traditional high-performance computing systems. Inspiration also comes from packages mirai by Gao (2023) &lt;https://github.com/shikokuchuo/mirai&gt;, future by Bengtsson (2021) &lt;doi:10.32614/RJ-2021-048&gt;, rrq by FitzJohn and Ashton (2023) &lt;https://github.com/mrc-ide/rrq&gt;, clustermq by Schubert (2019) &lt;doi:10.1093/bioinformatics/btz284&gt;), and batchtools by Lang, Bischl, and Surmann (2017). &lt;doi:10.21105/joss.00135&gt;.">
<meta property="og:description" content="In computationally demanding analysis projects, statisticians and data scientists asynchronously deploy long-running tasks to distributed systems, ranging from traditional clusters to cloud services. The crew.cluster package extends the mirai-powered crew package with worker launcher plugins for traditional high-performance computing systems. Inspiration also comes from packages mirai by Gao (2023) &lt;https://github.com/shikokuchuo/mirai&gt;, future by Bengtsson (2021) &lt;doi:10.32614/RJ-2021-048&gt;, rrq by FitzJohn and Ashton (2023) &lt;https://github.com/mrc-ide/rrq&gt;, clustermq by Schubert (2019) &lt;doi:10.1093/bioinformatics/btz284&gt;), and batchtools by Lang, Bischl, and Surmann (2017). &lt;doi:10.21105/joss.00135&gt;.">
<meta property="og:image" content="/logo.svg">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">crew.cluster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/wlandau/crew.cluster/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.svg" class="logo" alt=""><h1 id="crewcluster-crew-launcher-plugins-for-traditional-high-performance-computing-clusters-">crew.cluster: crew launcher plugins for traditional high-performance computing clusters <a class="anchor" aria-label="anchor" href="#crewcluster-crew-launcher-plugins-for-traditional-high-performance-computing-clusters-"></a>
</h1>
</div>
<p><a href="https://CRAN.R-project.org/package=crew.cluster" class="external-link"><img src="https://www.r-pkg.org/badges/version/crew.cluster" alt="CRAN"></a> <a href="https://www.repostatus.org/#Active" class="external-link"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="status"></a> <a href="https://github.com/wlandau/crew.cluster/actions?query=workflow%3Acheck" class="external-link"><img src="https://github.com/wlandau/crew.cluster/actions/workflows/check.yaml/badge.svg" alt="check"></a> <a href="https://app.codecov.io/gh/wlandau/crew.cluster" class="external-link"><img src="https://codecov.io/gh/wlandau/crew.cluster/branch/main/graph/badge.svg?token=3T5DlLwUVl" alt="codecov"></a> <a href="https://github.com/wlandau/crew.cluster/actions?query=workflow%3Alint" class="external-link"><img src="https://github.com/wlandau/crew.cluster/actions/workflows/lint.yaml/badge.svg" alt="lint"></a> <a href="https://github.com/wlandau/crew.cluster/actions?query=workflow%3Apkgdown" class="external-link"><img src="https://github.com/wlandau/crew.cluster/actions/workflows/pkgdown.yaml/badge.svg" alt="pkgdown"></a></p>
<p>In computationally demanding analysis projects, statisticians and data scientists asynchronously deploy long-running tasks to distributed systems, ranging from traditional clusters to cloud services. The <code>crew.cluster</code> package extends the <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a>-powered ‘crew’ package with worker launcher plugins for traditional high-performance computing systems. Inspiration also comes from packages <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a>, <a href="https://future.futureverse.org/" class="external-link"><code>future</code></a>, <a href="https://mrc-ide.github.io/rrq/" class="external-link"><code>rrq</code></a>, <a href="https://mschubert.github.io/clustermq/" class="external-link"><code>clustermq</code></a>, and <a href="https://mllg.github.io/batchtools/" class="external-link"><code>batchtools</code></a>.</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Type</th>
<th>Source</th>
<th>Command</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Release</td>
<td>CRAN</td>
<td><code>install.packages("crew.cluster")</code></td>
</tr>
<tr class="even">
<td>Development</td>
<td>GitHub</td>
<td><code>remotes::install_github("wlandau/crew.cluster")</code></td>
</tr>
<tr class="odd">
<td>Development</td>
<td>R-universe</td>
<td><code>install.packages("crew.cluster", repos = "https://wlandau.r-universe.dev")</code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level1">
<h1 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h1>
<p>Please see <a href="https://wlandau.github.io/crew.cluster/" class="external-link uri">https://wlandau.github.io/crew.cluster/</a> for documentation, including a full function reference and usage tutorial.</p>
</div>
<div class="section level1">
<h1 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h1>
<p>First, create a controller object appropriate for your platform. For example, to launch workers on a Sun Grid Engine (SGE) cluster, use <code><a href="reference/crew_controller_sge.html">crew_controller_sge()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wlandau.github.io/crew.cluster/" class="external-link">crew.cluster</a></span><span class="op">)</span></span>
<span><span class="va">controller</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/crew_controller_sge.html">crew_controller_sge</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"my_workflow"</span>, <span class="co"># for informative job names</span></span>
<span>  workers <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  tasks_max <span class="op">=</span> <span class="fl">2</span>, <span class="co"># to avoid reaching wall time limits</span></span>
<span>  seconds_idle <span class="op">=</span> <span class="fl">10</span>, <span class="co"># to release resources when they are not needed,</span></span>
<span>  <span class="co"># Try 16 GB memory first, then use 32 GB to retry if the worker crashes,</span></span>
<span>  <span class="co"># then 64 GB for all subsequent retries after failure. Go back to 16 GB</span></span>
<span>  <span class="co"># if the worker completes all its tasks before exiting.</span></span>
<span>  sge_memory_gigabytes_required <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">32</span>, <span class="fl">64</span><span class="op">)</span>,</span>
<span>  script_lines <span class="op">=</span> <span class="st">"module load R"</span> <span class="co"># if R is an environment module</span></span>
<span><span class="op">)</span></span>
<span><span class="va">controller</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>At this point, usage is exactly the same as basic <a href="https://wlandau.github.io/crew/" class="external-link"><code>crew</code></a>. The <code>push()</code> method submits tasks and auto-scales SGE workers to meet demand.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="fu">push</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"do work"</span>, command <span class="op">=</span> <span class="fu">do_work</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code>pop()</code> method retrieves available tasks.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="fu">pop</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 11</span></span>
<span><span class="co">#&gt;   name         command result seconds   seed error trace warni…¹ launc…² worker insta…³</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;   &lt;list&gt;   &lt;dbl&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1 do work   … do_work… &lt;int&gt;        0 1.56e8 NA    NA    NA      79e71c…      1 7686b2…</span></span>
<span><span class="co">#&gt; # … with abbreviated variable names ¹​warnings, ²​launcher, ³​instance</span></span></code></pre></div>
<p>Remember to terminate the controller when you are done.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">controller</span><span class="op">$</span><span class="fu">terminate</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="monitoring">Monitoring<a class="anchor" aria-label="anchor" href="#monitoring"></a>
</h1>
<p>To manage resource usage, you may choose to list and manually terminate cluster jobs using <code><a href="reference/crew_monitor_sge.html">crew_monitor_sge()</a></code> and other supported monitors. Example for SGE:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">monitor</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/crew_monitor_sge.html">crew_monitor_sge</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">job_list</span> <span class="op">&lt;-</span> <span class="va">monitor</span><span class="op">$</span><span class="fu">jobs</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">job_list</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 9</span></span>
<span><span class="co">#&gt;   job_number prio    name    owner state start_time queue_name jclass_name slots</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;lgl&gt;       &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 131853812  0.05000 crew-m… USER… r     2024-01-0… all.norma… NA          1    </span></span>
<span><span class="co">#&gt; 2 131853813  0.05000 crew-m… USER… r     2024-01-0… all.norma… NA          1</span></span>
<span><span class="va">monitor</span><span class="op">$</span><span class="fu">terminate</span><span class="op">(</span>jobs <span class="op">=</span> <span class="va">job_list</span><span class="op">$</span><span class="va">job_number</span><span class="op">)</span></span>
<span><span class="co">#&gt; USER has registered the job 131853812 for deletion</span></span>
<span><span class="co">#&gt; USER has registered the job 131853813 for deletion</span></span>
<span><span class="va">monitor</span><span class="op">$</span><span class="fu">jobs</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; data frame with 0 columns and 0 rows</span></span></code></pre></div>
<p><code>monitor$terminate(all = TRUE)</code> terminates all your SGE jobs, regardless of whether <code>crew.cluster</code> created them.</p>
</div>
<div class="section level1">
<h1 id="tips">Tips<a class="anchor" aria-label="anchor" href="#tips"></a>
</h1>
<ul>
<li>
<code>crew.cluster</code> submits jobs over the local network using system calls to the resource manager (e.g SGE or SLURM). Please invoke <code>crew.cluster</code> on a node of the cluster, either a login node (head node) or a compute node.</li>
<li>Most clusters install software like R in versioned environment modules. Most likely, you will need to call <code>module load R</code> (or <code>module load R/x.y.z</code> for a specific version) in order to use on the cluster. In <code>crew.cluster</code>, you will most likely need to supply <code>"module load R"</code> or similar to the <code>script_lines</code> argument of e.g. <code><a href="reference/crew_controller_sge.html">crew_controller_sge()</a></code>.</li>
</ul>
</div>
<div class="section level1">
<h1 id="risks">Risks<a class="anchor" aria-label="anchor" href="#risks"></a>
</h1>
<p>The risks of <code>crew.cluster</code> are the same as <a href="https://wlandau.github.io/crew/#risks" class="external-link">those of <code>crew</code></a>, plus the risks of traditional high-performance computing environments. These distributed systems typically operate inside a firewall and trust the local network. It is your responsibility to assess the security of these systems and use <code>crew.cluster</code> in a safe manner. In addition, <code>crew.cluster</code> automatically launches jobs on the cluster scheduler, and it may not always be able to terminate leftover jobs. It is your responsibility to monitor your jobs and manually terminate jobs that <code>crew.cluster</code> may not be able to.</p>
</div>
<div class="section level1">
<h1 id="thanks">Thanks<a class="anchor" aria-label="anchor" href="#thanks"></a>
</h1>
<ul>
<li>
<a href="https://github.com/shikokuchuo" class="external-link">Charlie Gao</a> created <a href="https://github.com/shikokuchuo/mirai" class="external-link"><code>mirai</code></a> and <a href="https://github.com/shikokuchuo/nanonext" class="external-link"><code>nanonext</code></a> and graciously accommodated the complicated and demanding feature requests that made <code>crew</code> and its ecosystem possible.</li>
<li>Thanks to <a href="https://github.com/mschubert" class="external-link">Michael Schubert</a> for sharing the <a href="https://github.com/mschubert/clustermq/tree/master/inst" class="external-link">template files</a> in <a href="https://github.com/mschubert/clustermq" class="external-link"><code>clustermq</code></a> under the permissive <a href="https://github.com/mschubert/clustermq/blob/master/LICENSE" class="external-link">Apache License 2.0</a>. These scripts helped construct launcher plugins to clusters where direct access was not possible. See the <a href="https://github.com/wlandau/crew.cluster/blob/main/LICENSE.note" class="external-link"><code>LICENSE.note</code></a> file in this package.</li>
</ul>
</div>
<div class="section level1">
<h1 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h1>
<p>Please note that the <code>crew</code> project is released with a <a href="https://github.com/wlandau/crew/blob/main/CODE_OF_CONDUCT.md" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
<div class="section level1">
<h1 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h1>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"crew.cluster"</span><span class="op">)</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=crew.cluster" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/wlandau/crew.cluster/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/wlandau/crew.cluster/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing crew.cluster</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>William Michael Landau <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1878-3253" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Michael Gilbert Levin <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-9937-9932" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Brendan Furneaux <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-3522-7363" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li> Eli Lilly and Company <br><small class="roles"> Copyright holder, funder </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by William Michael Landau, Michael Gilbert Levin, Brendan Furneaux, Eli Lilly and Company.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title> Create a controller with a
LSF launcher. — crew_controller_lsf • crew.cluster</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content=" Create a controller with a
LSF launcher. — crew_controller_lsf"><meta property="og:description" content="Create an R6 object to submit tasks and
launch workers on LSF workers."><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">crew.cluster</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/wlandau/crew.cluster/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a> Create a controller with a
LSF launcher.</h1>
    <small class="dont-index">Source: <a href="https://github.com/wlandau/crew.cluster/blob/HEAD/R/crew_controller_lsf.R" class="external-link"><code>R/crew_controller_lsf.R</code></a></small>
    <div class="hidden name"><code>crew_controller_lsf.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Create an <code>R6</code> object to submit tasks and
launch workers on LSF workers.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">crew_controller_lsf</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  host <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  port <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seconds_launch <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  seconds_interval <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  seconds_timeout <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  seconds_idle <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  seconds_wall <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  seconds_exit <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  tasks_max <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  tasks_timers <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  reset_globals <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  reset_packages <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  reset_options <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  garbage_collection <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  command_submit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"bsub"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  command_delete <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"bkill"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  script_directory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  script_lines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span>,</span>
<span>  lsf_cwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  lsf_log_output <span class="op">=</span> <span class="st">"/dev/null"</span>,</span>
<span>  lsf_log_error <span class="op">=</span> <span class="st">"/dev/null"</span>,</span>
<span>  lsf_memory_gigabytes_limit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lsf_memory_gigabytes_required <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lsf_cores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  auto_scale <span class="op">=</span> <span class="st">"demand"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>name</dt>
<dd><p>Name of the router object. If <code>NULL</code>, a name is automatically
generated.</p></dd>


<dt>workers</dt>
<dd><p>Integer, maximum number of parallel workers to run.</p></dd>


<dt>host</dt>
<dd><p>IP address of the <code>mirai</code> client to send and receive tasks.
If <code>NULL</code>, the host defaults to the local IP address.</p></dd>


<dt>port</dt>
<dd><p>TCP port to listen for the workers. If <code>NULL</code>,
then an available ephemeral port is automatically chosen.</p></dd>


<dt>seconds_launch</dt>
<dd><p>Seconds of startup time to allow.
A worker is unconditionally assumed to be alive
from the moment of its launch until <code>seconds_launch</code> seconds later.
After <code>seconds_launch</code> seconds, the worker is only
considered alive if it is actively connected to its assign websocket.</p></dd>


<dt>seconds_interval</dt>
<dd><p>Number of seconds between
polling intervals waiting for certain internal
synchronous operations to complete.</p></dd>


<dt>seconds_timeout</dt>
<dd><p>Number of seconds until timing
out while waiting for certain synchronous operations to complete.</p></dd>


<dt>seconds_idle</dt>
<dd><p>Maximum number of seconds that a worker can idle
since the completion of the last task. If exceeded, the worker exits.
But the timer does not launch until <code>tasks_timers</code> tasks
have completed.
See the <code>idletime</code> argument of <code><a href="https://shikokuchuo.net/mirai/reference/server.html" class="external-link">mirai::server()</a></code>. <code>crew</code> does not
excel with perfectly transient workers because it does not micromanage
the assignment of tasks to workers, so please allow enough idle
time for a new worker to be delegated a new task.</p></dd>


<dt>seconds_wall</dt>
<dd><p>Soft wall time in seconds.
The timer does not launch until <code>tasks_timers</code> tasks
have completed.
See the <code>walltime</code> argument of <code><a href="https://shikokuchuo.net/mirai/reference/server.html" class="external-link">mirai::server()</a></code>.</p></dd>


<dt>seconds_exit</dt>
<dd><p>Number of seconds to wait for NNG websockets
to finish sending large data (in case an exit signal is received).
See the <code>exitlinger</code> argument of <code><a href="https://shikokuchuo.net/mirai/reference/server.html" class="external-link">mirai::server()</a></code>.</p></dd>


<dt>tasks_max</dt>
<dd><p>Maximum number of tasks that a worker will do before
exiting. See the <code>maxtasks</code> argument of <code><a href="https://shikokuchuo.net/mirai/reference/server.html" class="external-link">mirai::server()</a></code>.
<code>crew</code> does not
excel with perfectly transient workers because it does not micromanage
the assignment of tasks to workers, it is recommended to set
<code>tasks_max</code> to a value greater than 1.</p></dd>


<dt>tasks_timers</dt>
<dd><p>Number of tasks to do before activating
the timers for <code>seconds_idle</code> and <code>seconds_wall</code>.
See the <code>timerlaunch</code> argument of <code><a href="https://shikokuchuo.net/mirai/reference/server.html" class="external-link">mirai::server()</a></code>.</p></dd>


<dt>reset_globals</dt>
<dd><p><code>TRUE</code> to reset global environment
variables between tasks, <code>FALSE</code> to leave them alone.</p></dd>


<dt>reset_packages</dt>
<dd><p><code>TRUE</code> to unload any packages loaded during
a task (runs between each task), <code>FALSE</code> to leave packages alone.</p></dd>


<dt>reset_options</dt>
<dd><p><code>TRUE</code> to reset global options to their original
state between each task, <code>FALSE</code> otherwise. It is recommended to
only set <code>reset_options = TRUE</code> if <code>reset_packages</code> is also <code>TRUE</code>
because packages sometimes rely on options they set at loading time.</p></dd>


<dt>garbage_collection</dt>
<dd><p><code>TRUE</code> to run garbage collection between
tasks, <code>FALSE</code> to skip.</p></dd>


<dt>verbose</dt>
<dd><p>Logical, whether to see console output and error messages
when submitting worker.</p></dd>


<dt>command_submit</dt>
<dd><p>Character of length 1,
file path to the executable to submit a worker job.</p></dd>


<dt>command_delete</dt>
<dd><p>Character of length 1,
file path to the executable to delete a worker job.</p></dd>


<dt>script_directory</dt>
<dd><p>Character of length 1, directory path to the
job scripts. Just before each job submission, a job script
is created in this folder. Script base names are unique to each
launcher and worker, and the launcher deletes the script when the
worker is manually terminated. <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code> is the default, but it
might not work for some systems.
<code>tools::R_user_dir("crew.cluster", which = "cache")</code>
is another reasonable choice.</p></dd>


<dt>script_lines</dt>
<dd><p>Optional character vector of additional lines to be
added to the job script just after the more common flags.
An example would be <code>script_lines = "module load R"</code> if your cluster
supports R through an environment module.</p></dd>


<dt>lsf_cwd</dt>
<dd><p>Character of length 1, directory to
launch the worker from (as opposed to
the system default). <code>lsf_cwd = "/home"</code> translates to a line of
<code>#BSUB -cwd /home</code> in the LSF job script. <code>lsf_cwd = getwd()</code> is the
default, which launches workers from the current working directory.#'
Set <code>lsf_cwd = NULL</code> to omit this line from the job script.</p></dd>


<dt>lsf_log_output</dt>
<dd><p>Character of length 1, file pattern to control
the locations of the LSF worker log files. By default, both standard
output and standard error go to the same file.
<code>lsf_log_output = "crew_log_%J.log"</code> translates to a line of
<code>#BSUB -o crew_log_%J.log</code> in the LSF job script,
where <code>%J</code> is replaced by the job ID of the worker.
The default is <code>/dev/null</code> to omit these logs.
Set <code>lsf_log_output = NULL</code> to omit this line from the job script.</p></dd>


<dt>lsf_log_error</dt>
<dd><p>Character of length 1, file pattern for standard
error. <code>lsf_log_error = "crew_error_%J.err"</code> translates to a line of
<code>#BSUB -e crew_error_%J.err</code> in the LSF job script,
where <code>%J</code> is replaced by the job ID of the worker.
The default is <code>/dev/null</code> to omit these logs.
Set <code>lsf_log_error = NULL</code> to omit this line from the job script.</p></dd>


<dt>lsf_memory_gigabytes_limit</dt>
<dd><p>Positive numeric of length 1
with the limit in gigabytes
<code>lsf_memory_gigabytes_limit = 4</code>
translates to a line of <code>#BSUB -M 4G</code>
in the LSF job script.
<code>lsf_memory_gigabytes_limit = NULL</code> omits this line.</p></dd>


<dt>lsf_memory_gigabytes_required</dt>
<dd><p>Positive numeric of length 1
with the memory requirement in gigabytes
<code>lsf_memory_gigabytes_required = 4</code>
translates to a line of <code>#BSUB -R 'rusage[mem=4G]'</code>
in the LSF job script.
<code>lsf_memory_gigabytes_required = NULL</code> omits this line.</p></dd>


<dt>lsf_cores</dt>
<dd><p>Optional positive integer of length 1,
number of CPU cores for the worker.
<code>lsf_cores = 4</code> translates
to a line of <code>#BSUB -n 4</code> in the LSF job script.
<code>lsf_cores = NULL</code> omits this line.</p></dd>


<dt>auto_scale</dt>
<dd><p>Character of length 1, name of the method for
automatically scaling workers to meet demand. <code>NULL</code> to default to
<code>"demand"</code>. Possible values include the following:</p><ul><li><p><code>"demand"</code>: just after pushing a new task in <code>push()</code>, launch
<code>min(n, max(0, t - w))</code> workers, where <code>n</code> is the maximum number of
workers, <code>t</code> is the number of queued tasks, and <code>w</code> is the current
number of workers already running. In other words, scale up the
number of workers to meet the current demand.
If you trust tasks not to crash workers, this is a good choice.
But if you think a task may always crash a worker
(e.g. segmentation fault or maxed out memory) then
this could be somewhat risky because <code>mirai</code> resubmits
failed tasks behind the scenes and <code>crew</code> responds by
re-launching workers. If you are worried about this scenario,
choose <code>auto_scale = "one"</code> instead, which will only launch
up to one worker whenever a task is pushed.</p></li>
<li><p><code>"one"</code>: just after pushing a new task in <code>push()</code>, launch
a one worker if demand <code>min(n, max(0, t - w))</code> is greater than 0.</p></li>
<li><p><code>"none"</code>: do not auto-scale at all.</p></li>
</ul></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>WARNING: the <code>crew.cluster</code> LSF plugin is experimental
and has not actually been tested on a LSF cluster. Please proceed
with caution and report bugs to
<a href="https://github.com/wlandau/crew.cluster" class="external-link">https://github.com/wlandau/crew.cluster</a>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other controllers: 
<code><a href="crew_controller_sge.html">crew_controller_sge</a>()</code>,
<code><a href="crew_controller_slurm.html">crew_controller_slurm</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CREW_EXAMPLES"</span><span class="op">)</span>, <span class="st">"true"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">controller</span> <span class="op">&lt;-</span> <span class="fu">crew_controller_lsf</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">controller</span><span class="op">$</span><span class="fu">start</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">controller</span><span class="op">$</span><span class="fu">push</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"task"</span>, command <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">controller</span><span class="op">$</span><span class="fu">wait</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">controller</span><span class="op">$</span><span class="fu">pop</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">result</span></span></span>
<span class="r-in"><span><span class="va">controller</span><span class="op">$</span><span class="fu">terminate</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by William Michael Landau, Michael Gilbert Levin.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

